<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Philanthropic Strategy Alignment Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D5A47;
            --primary-light: #3D7A5F;
            --primary-pale: #E8F0EC;
            --bg: #F5F3EF;
            --bg-white: #FAFAF8;
            --charcoal: #2C2C2C;
            --slate: #5A5A5A;
            --warning-color: #D4A017;
            --warning-bg: #FDF8E8;
            --warning-border: #E8C547;
            --error-color: #B84444;
            --error-bg: #FDEEEE;
            --error-border: #E07070;
            --text-primary: #2C2C2C;
            --text-secondary: #5A5A5A;
            --border: rgba(45, 90, 71, 0.15);
        }

```
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: 'Source Sans 3', -apple-system, sans-serif;
        background: var(--bg);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    header {
        text-align: center;
        padding: 3rem 0 2rem;
        border-bottom: 1px solid var(--border);
        margin-bottom: 2.5rem;
    }

    header h1 {
        font-family: 'Cormorant Garamond', Georgia, serif;
        font-size: 2rem;
        font-weight: 500;
        color: var(--primary);
        letter-spacing: 0.02em;
        margin-bottom: 0.5rem;
    }

    header p {
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 300;
        max-width: 600px;
        margin: 0 auto;
    }

    .main-layout {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 2rem;
        align-items: start;
    }

    @media (max-width: 900px) {
        .main-layout {
            grid-template-columns: 1fr;
        }
    }

    /* Input Panel */
    .input-panel {
        background: var(--bg-white);
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .section-title {
        font-family: 'Cormorant Garamond', Georgia, serif;
        font-size: 1.35rem;
        font-weight: 500;
        color: var(--primary);
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.75rem;
        margin-bottom: 1.25rem;
    }

    .field-group {
        margin-bottom: 1.25rem;
    }

    .field-group label {
        display: block;
        font-weight: 500;
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 0.4rem;
    }

    .field-group input[type="text"],
    .field-group select {
        width: 100%;
        padding: 0.65rem 0.85rem;
        border: 1px solid #d0d0d0;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        background: #fff;
        color: var(--text-primary);
        transition: border-color 0.2s;
    }

    .field-group input[type="text"]:focus,
    .field-group select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(45, 90, 71, 0.1);
    }

    .field-group input.error-input {
        border-color: var(--error-color);
        box-shadow: 0 0 0 3px rgba(184, 68, 68, 0.1);
    }

    .field-hint {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 0.3rem;
    }

    .amount-error {
        display: none;
        color: var(--error-color);
        font-size: 0.85rem;
        margin-top: 0.4rem;
        padding: 0.5rem 0.75rem;
        background: var(--error-bg);
        border-radius: 6px;
        border-left: 3px solid var(--error-color);
    }

    .amount-error.visible {
        display: block;
    }

    /* Axes Section */
    .axes-section {
        margin-top: 1.5rem;
    }

    .axis-item {
        margin-bottom: 1.4rem;
        padding-bottom: 1.2rem;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .axis-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .axis-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.25rem;
    }

    .axis-name {
        font-weight: 500;
        font-size: 0.95rem;
        color: var(--charcoal);
    }

    .axis-value {
        font-weight: 600;
        font-size: 0.9rem;
        background: var(--primary-pale);
        color: var(--primary);
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
    }

    .axis-labels {
        display: flex;
        justify-content: space-between;
        font-size: 0.78rem;
        color: var(--text-secondary);
        margin-bottom: 0.4rem;
    }

    /* Range Slider Styling */
    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, var(--primary) 0%, var(--primary) var(--progress, 50%), #ddd var(--progress, 50%), #ddd 100%);
        outline: none;
        cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary);
        border: 3px solid #fff;
        box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: transform 0.15s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.15);
    }

    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary);
        border: 3px solid #fff;
        box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        cursor: pointer;
    }

    /* Inline warnings below sliders */
    .axis-inline-warnings {
        margin-top: 0.5rem;
    }

    .axis-inline-warning {
        font-size: 0.82rem;
        padding: 0.4rem 0.65rem;
        border-radius: 5px;
        margin-top: 0.35rem;
        line-height: 1.4;
    }

    .axis-inline-warning.warning {
        background: var(--warning-bg);
        color: #8B6914;
        border-left: 3px solid var(--warning-color);
    }

    .axis-inline-warning.error {
        background: var(--error-bg);
        color: var(--error-color);
        border-left: 3px solid var(--error-color);
    }

    /* Feedback Panel (right sidebar) */
    .feedback-panel {
        position: sticky;
        top: 2rem;
    }

    .feedback-container {
        background: var(--bg-white);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        min-height: 200px;
    }

    .feedback-container h2 {
        font-family: 'Cormorant Garamond', Georgia, serif;
        font-size: 1.2rem;
        font-weight: 500;
        color: var(--primary);
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.65rem;
        margin-bottom: 1rem;
    }

    .feedback-empty {
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
        padding: 2rem 1rem;
    }

    .feedback-empty .check {
        font-size: 2rem;
        display: block;
        margin-bottom: 0.5rem;
    }

    .feedback-item {
        padding: 0.75rem 0.85rem;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        font-size: 0.88rem;
        line-height: 1.5;
    }

    .feedback-item.warning {
        background: var(--warning-bg);
        border-left: 4px solid var(--warning-color);
    }

    .feedback-item.error {
        background: var(--error-bg);
        border-left: 4px solid var(--error-color);
    }

    .feedback-item-header {
        font-weight: 600;
        margin-bottom: 0.3rem;
        font-size: 0.82rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
    }

    .feedback-item.warning .feedback-item-header { color: var(--warning-color); }
    .feedback-item.error .feedback-item-header { color: var(--error-color); }

    .feedback-count {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
    }

    .feedback-count .warn-count { color: var(--warning-color); font-weight: 600; }
    .feedback-count .err-count { color: var(--error-color); font-weight: 600; }

    /* Rules Configuration */
    .rules-section {
        background: var(--bg-white);
        border-radius: 12px;
        padding: 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        margin-top: 2rem;
    }

    .rules-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.25rem 1.5rem;
        cursor: pointer;
        user-select: none;
    }

    .rules-toggle:hover {
        background: rgba(0,0,0,0.015);
        border-radius: 12px;
    }

    .toggle-icon {
        width: 20px;
        height: 20px;
        color: var(--text-secondary);
        transition: transform 0.25s;
    }

    .toggle-icon.open {
        transform: rotate(180deg);
    }

    .rules-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.35s ease;
    }

    .rules-content.open {
        max-height: 800px;
    }

    .rules-inner {
        padding: 0 1.5rem 1.5rem;
    }

    .rules-instructions {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .rules-instructions code {
        background: #eee;
        padding: 0.1em 0.4em;
        border-radius: 3px;
        font-size: 0.82rem;
    }

    .rules-textarea {
        width: 100%;
        min-height: 200px;
        font-family: 'SFMono-Regular', Consolas, monospace;
        font-size: 0.78rem;
        line-height: 1.6;
        border: 1px solid #d0d0d0;
        border-radius: 8px;
        padding: 0.75rem;
        resize: vertical;
        color: var(--text-primary);
    }

    .rules-textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(45, 90, 71, 0.1);
    }

    .rules-actions {
        display: flex;
        gap: 0.75rem;
        margin-top: 0.75rem;
        align-items: center;
    }

    .btn {
        padding: 0.5rem 1.1rem;
        border: none;
        border-radius: 6px;
        font-size: 0.85rem;
        font-family: inherit;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-primary {
        background: var(--primary);
        color: #fff;
    }

    .btn-primary:hover {
        background: var(--primary-light);
    }

    .btn-secondary {
        background: #e8e8e8;
        color: var(--charcoal);
    }

    .btn-secondary:hover {
        background: #ddd;
    }

    .rules-status {
        font-size: 0.82rem;
        font-weight: 500;
    }

    .rules-status.success { color: var(--primary); }
    .rules-status.error { color: var(--error-color); }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <h1>Philanthropic Strategy Alignment Tool</h1>
            <p>Explore how your giving goals, focus areas, and organizational preferences interact â€” and where tensions may arise.</p>
        </header>

```
    <div class="main-layout">
        <div class="input-panel">
            <!-- Amount & Focus -->
            <div class="field-group">
                <label for="amount">Planned Annual Giving</label>
                <input type="text" id="amount" placeholder="e.g. $2,000,000 or 2M" />
                <div class="field-hint">Minimum $500,000. Enter as dollars (e.g. $500,000) or shorthand (e.g. 2M, 750K).</div>
                <div class="amount-error" id="amount-error">This tool is designed for donors giving $500,000 or more annually. Please enter an amount of at least $500K.</div>
            </div>

            <div class="field-group">
                <label for="focus">Primary Focus Area</label>
                <select id="focus">
                    <option value="">Select a focus area...</option>
                    <option value="education">Education</option>
                    <option value="global_health">Global Health</option>
                    <option value="economic_development">Economic Development</option>
                    <option value="climate_environment">Climate &amp; Environment</option>
                    <option value="human_rights">Human Rights &amp; Justice</option>
                    <option value="arts_culture">Arts &amp; Culture</option>
                    <option value="gender_equality">Gender Equality &amp; Women's Empowerment</option>
                    <option value="humanitarian">Humanitarian Relief</option>
                    <option value="peace_conflict">Peace &amp; Conflict Resolution</option>
                    <option value="food_agriculture">Food Security &amp; Agriculture</option>
                    <option value="technology">Technology &amp; Digital Inclusion</option>
                    <option value="youth_child">Youth &amp; Child Development</option>
                    <option value="philanthropy_infrastructure">Philanthropy Infrastructure &amp; Capacity</option>
                    <option value="faith_based">Faith-Based &amp; Spiritual Engagement</option>
                    <option value="civic_democracy">Civic Engagement &amp; Democracy</option>
                    <option value="mental_health">Mental Health &amp; Well-Being</option>
                    <option value="migration_refugees">Migration &amp; Refugees</option>
                    <option value="aging_longevity">Aging &amp; Longevity</option>
                    <option value="ai_ethics">Artificial Intelligence &amp; Technology Ethics</option>
                    <option value="democracy_information">Philanthropy for Democracy &amp; Information Integrity</option>
                </select>
            </div>

            <!-- 10 Axes -->
            <div class="axes-section">
                <h2 class="section-title">10 Axes of NGOs</h2>

                <div class="axis-item" data-axis="axis1">
                    <div class="axis-header">
                        <span class="axis-name">1. Geographic Scope</span>
                        <span class="axis-value" id="axis1-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Local</span>
                        <span>Global</span>
                    </div>
                    <input type="range" id="axis1" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis1-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis2">
                    <div class="axis-header">
                        <span class="axis-name">2. Capital Approach</span>
                        <span class="axis-value" id="axis2-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Grants</span>
                        <span>Impact Investing</span>
                    </div>
                    <input type="range" id="axis2" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis2-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis3">
                    <div class="axis-header">
                        <span class="axis-name">3. Theory of Change</span>
                        <span class="axis-value" id="axis3-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Direct Action</span>
                        <span>Systems Change</span>
                    </div>
                    <input type="range" id="axis3" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis3-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis4">
                    <div class="axis-header">
                        <span class="axis-name">4. Measurability</span>
                        <span class="axis-value" id="axis4-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Hard to Measure</span>
                        <span>Highly Measurable</span>
                    </div>
                    <input type="range" id="axis4" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis4-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis5">
                    <div class="axis-header">
                        <span class="axis-name">5. Organizational Scale</span>
                        <span class="axis-value" id="axis5-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Grassroots</span>
                        <span>Institutional</span>
                    </div>
                    <input type="range" id="axis5" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis5-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis6">
                    <div class="axis-header">
                        <span class="axis-name">6. Maturity</span>
                        <span class="axis-value" id="axis6-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Emergent</span>
                        <span>Established</span>
                    </div>
                    <input type="range" id="axis6" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis6-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis7">
                    <div class="axis-header">
                        <span class="axis-name">7. Operational Style</span>
                        <span class="axis-value" id="axis7-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Exploratory</span>
                        <span>Execution-Focused</span>
                    </div>
                    <input type="range" id="axis7" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis7-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis8">
                    <div class="axis-header">
                        <span class="axis-name">8. Disruption Level</span>
                        <span class="axis-value" id="axis8-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Incremental</span>
                        <span>Disruptive</span>
                    </div>
                    <input type="range" id="axis8" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis8-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis9">
                    <div class="axis-header">
                        <span class="axis-name">9. Political Orientation</span>
                        <span class="axis-value" id="axis9-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Apolitical</span>
                        <span>Politically Engaged</span>
                    </div>
                    <input type="range" id="axis9" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis9-warnings"></div>
                </div>

                <div class="axis-item" data-axis="axis10">
                    <div class="axis-header">
                        <span class="axis-name">10. Faith Orientation</span>
                        <span class="axis-value" id="axis10-value">3</span>
                    </div>
                    <div class="axis-labels">
                        <span>Religious</span>
                        <span>Secular</span>
                    </div>
                    <input type="range" id="axis10" min="1" max="5" value="3" />
                    <div class="axis-inline-warnings" id="axis10-warnings"></div>
                </div>
            </div>
        </div>

        <!-- Feedback Panel -->
        <div class="feedback-panel">
            <div class="feedback-container" id="feedback-container">
                <h2>Strategic Feedback</h2>
                <div class="feedback-empty">
                    <span class="check">&#10003;</span>
                    No strategic tensions detected. Adjust your inputs to explore tradeoffs.
                </div>
            </div>
        </div>
    </div>

    <!-- Rules Configuration (collapsible) -->
    <div class="rules-section">
        <div class="rules-toggle" onclick="toggleRules()">
            <h2 class="section-title" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">Rules Configuration</h2>
            <svg class="toggle-icon" id="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>

        <div class="rules-content" id="rules-content">
            <div class="rules-inner">
                <p class="rules-instructions">
                    Paste rules from your spreadsheet below. Each line should follow this format:<br>
                    <code>SEVERITY | CONDITION | MESSAGE</code> &nbsp;or tab-separated from Google Sheets<br><br>
                    Severity: <code>warning</code> (yellow) or <code>error</code> (red)<br>
                    Variables: <code>amount</code>, <code>focus</code>, <code>axis1</code> through <code>axis10</code><br>
                    Operators: <code>&gt;</code>, <code>&lt;</code>, <code>=</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>AND</code>, <code>OR</code>
                </p>

                <textarea class="rules-textarea" id="rules-input" placeholder="Paste rules here..."></textarea>

                <div class="rules-actions">
                    <button class="btn btn-primary" onclick="loadRules()">Load Rules</button>
                    <button class="btn btn-secondary" onclick="resetRules()">Reset to Defaults</button>
                    <span class="rules-status" id="rules-status"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ===== Variable name mapping for bold display =====
    var varNames = {
        "amount": "GIVING AMOUNT",
        "focus": "FOCUS AREA",
        "axis1": "GEOGRAPHIC SCOPE",
        "axis2": "CAPITAL APPROACH",
        "axis3": "THEORY OF CHANGE",
        "axis4": "MEASURABILITY",
        "axis5": "ORGANIZATIONAL SCALE",
        "axis6": "MATURITY",
        "axis7": "OPERATIONAL STYLE",
        "axis8": "DISRUPTION LEVEL",
        "axis9": "POLITICAL ORIENTATION",
        "axis10": "FAITH ORIENTATION"
    };

    // ===== Default Rules =====
    var defaultRules = [
        "warning | amount < 500000 AND axis1 >= 4 | Global-scale philanthropy typically requires $500K+ annually to achieve meaningful influence.",
        "error | amount < 250000 AND axis1 = 5 AND axis3 >= 4 | Fully global, systems-change work is extremely difficult to fund effectively under $250K/year. Consider local or direct-action approaches.",
        "warning | axis3 >= 4 AND axis4 >= 4 | Systemic change and high measurability are inherently in tension. Systems work takes years and causation is diffuse.",
        "error | amount < 100000 AND axis3 = 5 | Long-horizon systemic change requires patient capital at scale. Under $100K/year, consider more direct-action strategies.",
        "warning | axis1 >= 4 AND axis5 <= 2 | Global reach with grassroots organizations is rare. Most grassroots groups operate locally or regionally.",
        "warning | axis6 <= 2 AND axis7 >= 4 | Emergent organizations are rarely execution-focused; they are still discovering what works.",
        "warning | axis8 >= 4 AND axis9 <= 2 | Disruptive organizations are rarely apolitical. Disruption tends to challenge existing power structures.",
        "warning | axis3 <= 2 AND axis8 >= 4 | Direct-action approaches and high disruption are an unusual combination. Disruption typically implies systems-level change.",
        "warning | axis5 <= 2 AND axis4 >= 4 | Grassroots organizations often lack the infrastructure for rigorous measurement.",
        "warning | axis6 <= 2 AND axis4 >= 4 | Emergent organizations rarely have robust measurement systems in place.",
        "error | amount < 500000 AND axis1 >= 4 AND axis3 >= 4 AND axis4 >= 4 | Global systems change with high measurability at under $500K/year is an extremely challenging combination. Consider narrowing geographic scope or adjusting expectations for measurement.",
        "warning | focus = peace_conflict AND axis9 <= 2 | Peace and conflict resolution work is inherently political. An apolitical orientation may limit effectiveness in this space.",
        "warning | focus = climate_environment AND axis3 <= 2 AND axis1 >= 4 | Global climate work focused only on direct action may have limited scale impact. Consider systems-change approaches.",
        "warning | focus = arts_culture AND axis4 >= 4 | Arts and culture outcomes are notoriously difficult to measure with high precision. Consider adjusting measurability expectations."
    ].join("\n");

    var currentRules = [];

    // ===== Parse Amount =====
    function parseAmount(str) {
        if (!str) return 0;
        str = str.replace(/[$,\s]/g, "").toUpperCase();
        if (str.indexOf("M") >= 0) {
            return parseFloat(str.replace("M", "")) * 1000000;
        }
        if (str.indexOf("K") >= 0) {
            return parseFloat(str.replace("K", "")) * 1000;
        }
        return parseFloat(str) || 0;
    }

    // ===== Parse Rules =====
    function parseRules(text) {
        var lines = text.split("\n");
        var rules = [];
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i].trim();
            if (!line) continue;

            var parts;
            // Detect tab-separated (from Google Sheets) vs pipe-separated
            if (line.indexOf("\t") >= 0) {
                parts = line.split("\t");
            } else {
                parts = line.split("|");
            }

            if (parts.length < 3) continue;

            var severity = parts[0].trim().toLowerCase();
            var condition = parts[1].trim();
            var message = parts[2].trim();

            if (severity !== "warning" && severity !== "error") continue;

            // Extract referenced variables for inline display
            var referencedAxes = [];
            var varKeys = ["axis10", "axis1", "axis2", "axis3", "axis4", "axis5", "axis6", "axis7", "axis8", "axis9", "amount", "focus"];
            for (var v = 0; v < varKeys.length; v++) {
                if (condition.indexOf(varKeys[v]) >= 0) {
                    referencedAxes.push(varKeys[v]);
                }
            }

            rules.push({
                severity: severity,
                condition: condition,
                message: message,
                axes: referencedAxes
            });
        }
        return rules;
    }

    // ===== Evaluate Condition =====
    function evaluateCondition(condition, values) {
        // Split by OR first
        var orParts = condition.split(/\s+OR\s+/);
        for (var o = 0; o < orParts.length; o++) {
            var andParts = orParts[o].split(/\s+AND\s+/);
            var allTrue = true;
            for (var a = 0; a < andParts.length; a++) {
                if (!evaluateSingle(andParts[a].trim(), values)) {
                    allTrue = false;
                    break;
                }
            }
            if (allTrue) return true;
        }
        return false;
    }

    function evaluateSingle(expr, values) {
        var operators = [">=", "<=", "!=", "=", ">", "<"];
        for (var i = 0; i < operators.length; i++) {
            var op = operators[i];
            var idx = expr.indexOf(op);
            if (idx >= 0) {
                var left = expr.substring(0, idx).trim();
                var right = expr.substring(idx + op.length).trim();

                var leftVal = values[left] !== undefined ? values[left] : left;
                var rightVal = values[right] !== undefined ? values[right] : right;

                var leftNum = parseFloat(leftVal);
                var rightNum = parseFloat(rightVal);

                if (!isNaN(leftNum) && !isNaN(rightNum)) {
                    switch (op) {
                        case ">=": return leftNum >= rightNum;
                        case "<=": return leftNum <= rightNum;
                        case "!=": return leftNum !== rightNum;
                        case "=":  return leftNum === rightNum;
                        case ">":  return leftNum > rightNum;
                        case "<":  return leftNum < rightNum;
                    }
                } else {
                    // String comparison
                    switch (op) {
                        case "=":  return String(leftVal) === String(rightVal);
                        case "!=": return String(leftVal) !== String(rightVal);
                        default:   return false;
                    }
                }
            }
        }
        return false;
    }

    // ===== Get Current Values =====
    function getValues() {
        var vals = {};
        vals.amount = parseAmount(document.getElementById("amount").value);
        vals.focus = document.getElementById("focus").value;
        for (var i = 1; i <= 10; i++) {
            vals["axis" + i] = parseInt(document.getElementById("axis" + i).value);
        }
        return vals;
    }

    // ===== Bold variable names in messages =====
    function highlightVars(message, axes) {
        // Find which axis variable names appear and bold them in the message
        // We'll look for known terms in the message and bold + capitalize them
        var result = message;
        // Map axis IDs to display terms that might appear in messages
        var termMap = {
            "axis1": ["global", "local", "geographic"],
            "axis2": ["grants", "impact investing", "capital"],
            "axis3": ["systems change", "systemic", "direct-action", "direct action"],
            "axis4": ["measur", "attribution"],
            "axis5": ["grassroots", "institutional"],
            "axis6": ["emergent", "established"],
            "axis7": ["execution", "exploratory"],
            "axis8": ["disrupt"],
            "axis9": ["apolitical", "political"],
            "axis10": ["religious", "secular", "faith"],
            "amount": ["$500k", "$250k", "$100k", "annual", "giving", "under $"]
        };
        return result;
    }

    // ===== Update Feedback =====
    function updateFeedback() {
        var values = getValues();
        var container = document.getElementById("feedback-container");
        var amountInput = document.getElementById("amount");
        var amountError = document.getElementById("amount-error");

        // Check amount minimum
        var amountVal = values.amount;
        if (amountInput.value.trim() !== "" && amountVal > 0 && amountVal < 500000) {
            amountInput.classList.add("error-input");
            amountError.classList.add("visible");
        } else {
            amountInput.classList.remove("error-input");
            amountError.classList.remove("visible");
        }

        // Clear all inline warnings
        for (var c = 1; c <= 10; c++) {
            document.getElementById("axis" + c + "-warnings").innerHTML = "";
        }

        // Evaluate rules
        var triggered = [];
        for (var r = 0; r < currentRules.length; r++) {
            var rule = currentRules[r];
            if (evaluateCondition(rule.condition, values)) {
                triggered.push(rule);

                // Show inline warnings under relevant axes
                for (var ax = 0; ax < rule.axes.length; ax++) {
                    var axisId = rule.axes[ax];
                    if (axisId.indexOf("axis") === 0) {
                        var warnContainer = document.getElementById(axisId + "-warnings");
                        if (warnContainer) {
                            var div = document.createElement("div");
                            div.className = "axis-inline-warning " + rule.severity;
                            div.textContent = rule.message;
                            warnContainer.appendChild(div);
                        }
                    }
                }
            }
        }

        // Build feedback panel
        var html = '<h2>Strategic Feedback</h2>';

        if (triggered.length === 0) {
            html += '<div class="feedback-empty"><span class="check">&#10003;</span>No strategic tensions detected. Adjust your inputs to explore tradeoffs.</div>';
        } else {
            var warnings = 0;
            var errors = 0;
            for (var t = 0; t < triggered.length; t++) {
                if (triggered[t].severity === "warning") warnings++;
                else errors++;
            }
            html += '<div class="feedback-count">';
            if (errors > 0) html += '<span class="err-count">' + errors + ' incompatibilit' + (errors === 1 ? 'y' : 'ies') + '</span>';
            if (errors > 0 && warnings > 0) html += ' &middot; ';
            if (warnings > 0) html += '<span class="warn-count">' + warnings + ' tension' + (warnings === 1 ? '' : 's') + '</span>';
            html += '</div>';

            for (var t2 = 0; t2 < triggered.length; t2++) {
                var rule2 = triggered[t2];
                var icon = rule2.severity === "error" ? "&#9888;" : "&#9888;";
                var label = rule2.severity === "error" ? "Incompatibility" : "Tension";

                // Bold the variable names in the message
                var msg = rule2.message;
                for (var a2 = 0; a2 < rule2.axes.length; a2++) {
                    var vn = varNames[rule2.axes[a2]];
                    if (vn) {
                        // We don't replace in message text since var names don't appear literally
                        // Instead we prefix with the involved axes
                    }
                }

                var axisLabels = [];
                for (var a3 = 0; a3 < rule2.axes.length; a3++) {
                    if (varNames[rule2.axes[a3]]) {
                        axisLabels.push('<strong>' + varNames[rule2.axes[a3]] + '</strong>');
                    }
                }

                html += '<div class="feedback-item ' + rule2.severity + '">';
                html += '<div class="feedback-item-header">' + icon + ' ' + label + '</div>';
                if (axisLabels.length > 0) {
                    html += '<div style="font-size:0.78rem;margin-bottom:0.3rem;color:var(--text-secondary)">' + axisLabels.join(' &middot; ') + '</div>';
                }
                html += msg;
                html += '</div>';
            }
        }

        container.innerHTML = html;
    }

    // ===== Slider Updates =====
    function updateSlider(sliderId) {
        var slider = document.getElementById(sliderId);
        var valueDisplay = document.getElementById(sliderId + "-value");
        var value = slider.value;
        var min = slider.min;
        var max = slider.max;
        var progress = ((value - min) / (max - min)) * 100;

        slider.style.setProperty("--progress", progress + "%");
        valueDisplay.textContent = value;
    }

    function initSliders() {
        for (var i = 1; i <= 10; i++) {
            var sliderId = "axis" + i;
            updateSlider(sliderId);

            (function(id) {
                document.getElementById(id).addEventListener("input", function() {
                    updateSlider(id);
                    updateFeedback();
                });
            })(sliderId);
        }
    }

    // ===== Rules Toggle =====
    function toggleRules() {
        var content = document.getElementById("rules-content");
        var icon = document.getElementById("toggle-icon");
        if (content.className.indexOf("open") >= 0) {
            content.className = "rules-content";
            icon.className = "toggle-icon";
        } else {
            content.className = "rules-content open";
            icon.className = "toggle-icon open";
        }
    }

    // ===== Load / Reset Rules =====
    function loadRules() {
        var input = document.getElementById("rules-input").value;
        var status = document.getElementById("rules-status");

        try {
            currentRules = parseRules(input);
            status.textContent = "Loaded " + currentRules.length + " rules";
            status.className = "rules-status success";
            updateFeedback();

            setTimeout(function() {
                status.textContent = "";
            }, 3000);
        } catch (e) {
            status.textContent = "Error parsing rules";
            status.className = "rules-status error";
        }
    }

    function resetRules() {
        document.getElementById("rules-input").value = defaultRules;
        loadRules();
    }

    // ===== Initialize =====
    window.onload = function() {
        document.getElementById("rules-input").value = defaultRules;
        initSliders();
        loadRules();

        document.getElementById("amount").addEventListener("input", updateFeedback);
        document.getElementById("focus").addEventListener("change", updateFeedback);
    };
</script>
```

</body>
</html>